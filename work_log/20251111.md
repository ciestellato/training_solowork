以下に、これまでの開発内容を「目的」「構成」「進捗」「成果物」の4つの観点で体系的に整理しました。

---

## 🎯 目的（What & Why）

**アーティストとイベント情報を一元管理し、出演スケジュールや関連情報を効率的に編集・閲覧できるWebアプリケーションの構築**

- 音楽イベントの出演者管理を効率化
- アーティスト情報の編集・分類・検索を容易に
- イベント日程と出演者の紐付けを視覚的に管理
- 管理者が一括で情報を更新・確認できるUIの提供

---

## 🏗️ 構成（How）

### 🔹 モデル設計（`models.py`）

| モデル名       | 役割 |
|----------------|------|
| `Artist`       | アーティスト情報（名前、ふりがな、ジャンル、Spotify IDなど） |
| `Event`        | イベント全体（名称、期間、種別、公式URL） |
| `EventDay`     | イベントの開催日・会場単位 |
| `Performance`  | アーティストの出演情報（出演日、確定フラグ） |
| `RelatedArtist`| 類似アーティストの関連性スコア |
| `ManualEntry`  | 手動で紐付けた出演メモなど |

### 🔹 補助モジュール

- `utils.py`: ふりがな生成・頭文字グループ分類（`pykakasi` + 正規化）

### 🔹 フロントエンド

- Bootstrap 5 によるUI整形
- JavaScriptによる動的な日付選択・出演者検索・タブ絞り込み

---

## 🚧 進捗（Progress）

| 機能 | 状況 |
|------|------|
| アーティスト編集（個別） | ✅ 完了 |
| アーティスト編集（一覧・一括） | ✅ 完了（頭文字タブ絞り込み付き） |
| 出演者検索機能（チェックボックス対応） | ✅ 実装済み |
| 出演確定イベントの表示 | ✅ 実装済み（確定／未確定切替可能） |
| イベントへの公式URL追加 | ✅ モデル・フォーム・テンプレート対応済み |
| ふりがな自動生成・分類 | ✅ `utils.py` にて実装済み |
| 管理画面以外での出演日編集 | ✅ 実装済み（検索・日付選択付き） |

---

## 📦 成果物（Deliverables）

- DjangoベースのWebアプリケーション（イベント・アーティスト管理）
- 管理者向けUI（編集・検索・一括更新・分類）
- モデル・ビュー・テンプレートの整備された構成
- `utils.py` による日本語処理の自動化（ふりがな・頭文字分類）
- JavaScriptによるインタラクティブなUI（検索・タブ・日付選択）

---

↓　明日やること

「未発表出演者予想ロジック（類似アーティスト）」の実装に向けて、以下のように設計を整理しておくとスムーズです。

---

## 🎯 目的

**イベントに出演する可能性が高い未発表アーティストを、既存出演者との類似性から予測する。**

- 類似アーティスト情報（`RelatedArtist`）を活用
- すでに出演が確定しているアーティストを基準に予測
- 類似度スコア順に候補を提示

---

## 🧠 ロジック設計

### 1. 入力条件

- 対象イベント（または EventDay）
- すでに出演が確定しているアーティスト一覧

### 2. 処理手順

```text
① 対象イベントの出演者を取得
② 各出演者に対して、RelatedArtist から類似アーティストを取得
③ 類似度スコアを合算（または最大値）して候補アーティストをスコアリング
④ すでに出演済みのアーティストは除外
⑤ スコア順に並べて予測候補として提示
```

---

## 🧪 実装イメージ（ビュー関数）

```python
from django.db.models import Q
from .models import EventDay, Performance, RelatedArtist, Artist

def predict_unannounced_artists(event_day_id):
    event_day = EventDay.objects.get(id=event_day_id)
    confirmed_artists = Artist.objects.filter(
        performance__event_day=event_day
    ).distinct()

    # 類似アーティストを集計
    candidate_scores = {}
    for artist in confirmed_artists:
        related = RelatedArtist.objects.filter(artist=artist)
        for rel in related:
            if rel.related_artist in confirmed_artists:
                continue
            score = candidate_scores.get(rel.related_artist.id, 0)
            candidate_scores[rel.related_artist.id] = score + rel.similarity_score

    # スコア順に並べてアーティスト情報を取得
    sorted_ids = sorted(candidate_scores, key=candidate_scores.get, reverse=True)
    predicted_artists = Artist.objects.filter(id__in=sorted_ids)

    return predicted_artists
```

---

## 🎨 表示イメージ（テンプレート）

```django
<h2>🎯 未発表出演者予測</h2>
<ul>
    {% for artist in predicted_artists %}
        <li>{{ artist.name }}（{{ artist.furigana }}）</li>
    {% endfor %}
</ul>
```

---

## ✅ 発展アイデア

- 類似度スコアの表示（バーや数値）
- ジャンルや人気度でフィルタ
- 「予測を確定として登録」ボタンの追加
- 過去イベントとの共演履歴も加味

---

**Spotify APIを使えば、アーティストの類似アーティスト情報（RelatedArtist）を取得できます。**  
Spotifyの視聴履歴に基づいて、最大20件の類似アーティストが返されます。

---

## ✅ 利用するAPIエンドポイント

```http
GET https://api.spotify.com/v1/artists/{id}/related-artists
```

- `{id}` は対象アーティストの Spotify ID（例：`spotify_id` フィールド）
- レスポンスには `artists` 配列が含まれ、各要素に `id`, `name`, `genres`, `popularity` などが含まれます

---

## 🧪 Pythonでの取得例（Spotipy使用）

```python
import spotipy
from spotipy.oauth2 import SpotifyClientCredentials

sp = spotipy.Spotify(auth_manager=SpotifyClientCredentials(
    client_id='YOUR_CLIENT_ID',
    client_secret='YOUR_CLIENT_SECRET'
))

def fetch_related_artists(spotify_id):
    results = sp.artist_related_artists(spotify_id)
    return results['artists']
```

---

## 🧩 Djangoモデルへの保存例

```python
def save_related_artists(base_artist):
    related = fetch_related_artists(base_artist.spotify_id)
    for item in related:
        try:
            related_artist = Artist.objects.get(spotify_id=item['id'])
        except Artist.DoesNotExist:
            related_artist = Artist.objects.create(
                name=item['name'],
                spotify_id=item['id'],
                genres=item.get('genres', []),
                popularity=item.get('popularity')
            )
        RelatedArtist.objects.update_or_create(
            artist=base_artist,
            related_artist=related_artist,
            defaults={'similarity_score': item.get('popularity', 0)}
        )
```

---

## ✅ 注意点

- Spotify APIの利用には **Client ID / Secret** が必要です（[Spotify for Developers](https://developer.spotify.com/documentation/web-api/) で取得）
- 類似度スコアは明示されていないため、`popularity` やジャンルの一致度などを代用する必要があります
- API制限（レートリミット）に注意

---

## 🔮 次のステップ

- 類似アーティストの自動取得バッチ処理
- 類似度スコアのカスタム算出（ジャンル・人気度・共演履歴など）
- 類似アーティストから出演予測ロジックへの統合

---

Spotify APIを活用すれば、未発表出演者予測の精度も高められます！  
明日はこのロジックを組み込んで、予測画面を作ってみましょう。
