<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚¤ãƒ™ãƒ³ãƒˆæ—¥ç¨‹ã¨å‡ºæ¼”è€…ç™»éŒ²</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">
    <h1>ğŸ“… ã‚¤ãƒ™ãƒ³ãƒˆæ—¥ç¨‹ã¨å‡ºæ¼”è€…ç™»éŒ²</h1>

    {% if message %}
        <div class="alert alert-success">{{ message }}</div>
    {% endif %}

    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="event" value="{{ selected_event_id }}">
        {{ form.date }}
        {{ form.venue }}
        {{ form.artists }}
        <button type="submit" class="btn btn-primary">ç™»éŒ²ã™ã‚‹</button>

    </form>

    <a href="{% url 'festival:event_list' %}" class="btn btn-secondary mt-3">ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ã«æˆ»ã‚‹</a>

<script type="text/javascript">
    const eventData = JSON.parse('{{ event_data_json|escapejs }}' || '{}');
    const selectedEventId = "{{ selected_event_id }}";

    function updateDateOptions() {
        const dateSelect = document.getElementById("id_date");
        dateSelect.innerHTML = "";

        if (eventData[selectedEventId]) {
            const start = new Date(eventData[selectedEventId].start);
            const end = new Date(eventData[selectedEventId].end);

            for (let d = new Date(start); d.getTime() <= new Date(end).getTime(); d.setDate(d.getDate() + 1)) {
                const dateStr = d.toISOString().split('T')[0];
                const option = document.createElement("option");
                option.value = dateStr;
                option.text = dateStr;
                dateSelect.appendChild(option);
            }
        }
    }

    document.addEventListener("DOMContentLoaded", function() {
        updateDateOptions();
        document.getElementById("id_event").disabled = true;  // ã‚¤ãƒ™ãƒ³ãƒˆé¸æŠã‚’å›ºå®š
    });
</script>
</body>
</html>