{% extends 'base.html' %}

{% block title %}ã‚¿ã‚¤ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º{% endblock %}

{% block content %}
<h1>ğŸª ã‚¿ã‚¤ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º</h1>

<!-- ã‚¤ãƒ™ãƒ³ãƒˆæ—¥ç¨‹é¸æŠ -->
<form method="GET" class="mb-4">
    <label for="event_day" class="form-label">ã‚¤ãƒ™ãƒ³ãƒˆæ—¥ç¨‹ã‚’é¸æŠ</label>
    <div class="input-group">
        <select name="event_day" id="event_day" class="form-select">
            {% for day in event_days %}
                <option value="{{ day.id }}" {% if day.id|stringformat:"s" == selected_day_id %}selected{% endif %}>
                    {{ day.date }} @ {{ day.venue }}
                </option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btn-outline-primary">è¡¨ç¤º</button>
    </div>
</form>

{% if event_day %}
    <h2 class="mt-4">{{ event_day.date }} @ {{ event_day.venue }}</h2>

    <!-- æ—¥ä»˜åˆ‡ã‚Šæ›¿ãˆãƒªãƒ³ã‚¯ -->
    <div class="mb-4">
        <span class="fw-bold">ä»–ã®æ—¥ç¨‹ï¼š</span>
        {% for day in event_days %}
            {% if day.event.id == event_day.event.id and day.id != event_day.id %}
                <a href="?event_day={{ day.id }}" class="btn btn-sm btn-outline-secondary me-2">
                    {{ day.date }}
                </a>
            {% endif %}
        {% endfor %}
    </div>

    {% for stage in stages %}
        <div class="mt-5">
            <h4>ğŸ¤ {{ stage.name }}</h4>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>æ™‚é–“</th>
                        <th>ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ</th>
                    </tr>
                </thead>
                <tbody>
                {% for perf in stage.performance_set.all|dictsort:"start_time" %}
                    {% if perf.event_day.id == event_day.id %}
                        <tr>
                            <td>
                                {% if perf.start_time and perf.end_time %}
                                    {{ perf.start_time|time:"H:i" }} - {{ perf.end_time|time:"H:i" }}
                                {% else %}
                                    æœªå®š
                                {% endif %}
                            </td>
                            <td>
                                {{ perf.artist.name }}
                                <a href="{% url 'festival:edit_performance' perf.id %}" class="btn btn-sm btn-outline-primary ms-2">ç·¨é›†</a>
                            </td>
                        </tr>
                    {% endif %}
                {% empty %}
                    <tr><td colspan="2">å‡ºæ¼”è€…æœªç™»éŒ²</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    {% endfor %}
{% endif %}

<a href="{% url 'festival:event_list' %}" class="btn btn-secondary mt-4">ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ã¸æˆ»ã‚‹</a>
{% endblock %}